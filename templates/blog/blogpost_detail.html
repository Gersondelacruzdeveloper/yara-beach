{% extends 'base2.html' %}
{% load static %}
{% block content %}
  <article class="blog-post">
    <p>By {{ post.author }} on {{ post.created_at|date:"F d, Y" }}</p>
    <p><span class="rating">⭐ {{ post.rating }}/5 Reviews</span>

        <div class="gallery">
            {% if post.featured_image %}
            <img src="{{ post.featured_image.url }}" alt="{{ post.title }}" style="max-width: 100%;">
            {% endif %}
    
            {% for image in post.images.all %}
                <img loading="lazy" src="{{ image.image_url }}" alt="Blog post image for {{ blog_post.title }}">
             {% endfor %}
        </div>

        <div class="fullscreen" id="fullscreen">
            <span class="close-btn" onclick="closeFullscreen()">&#10005;</span>
            <span class="counter" id="counter"></span>
            <img id="fullscreen-img" src="" alt="Fullscreen Image">
            <span class="arrow arrow-left" onclick="prevImage()">&#10094;</span>
            <span class="arrow arrow-right" onclick="nextImage()">&#10095;</span>
          </div>
          
        
        
        {% if post.video_id %}
        <div style="width:100%">
          <iframe width="100%" height="300px" src="https://www.youtube.com/embed/{{post.video_id}}"
            title="YouTube video player" frameborder="0"
            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
            allowfullscreen></iframe>
        </div>
        {% endif%}

    <div class="blog-content">
      {{ post.content|safe }}
    </div>

    <!-- <p><strong>Estimated read time:</strong> {{ post.read_time }} minutes</p> -->
    <p><strong><i class="fa-solid fa-eye"></i>:</strong> {{ post.view_count }}</p>

    {% if related_activities %}
<div class="related-activities">
  <h2>Related Punta Cana Activities</h2>
  <div class="related-activities-slider">
    {% for excursion in related_activities %}
    <div class="card-container">
      <div class="card">
        <img src="{{excursion.main_image.url}}" loading="lazy" alt="Punta Cana beach tour - {{excursion.title}}">
        <div class="content">
          <div class="tag">ACTIVITIES</div>
          <h3>{{excursion.title|slice:":60"|title}}...</h3>
          {% if excursion.duration_time %}
          <span class="img_icon1 badge rounded-pill bg-warning text-dark">
            <i class="fa-solid fa-hourglass-start"></i> {{excursion.duration_time}} hours</span>
          {% endif %}
          {% if excursion.tour_guide %}
          <span class="img_icon2 badge rounded-pill bg-warning text-dark">
            <i class="fa-solid fa-user"></i> Tour Guide</span>
          {% endif %}
          {% if excursion.transportation %}
          <span class="img_icon3  badge rounded-pill bg-warning text-dark">
            <i class="fa-solid fa-van-shuttle"></i> Transportation</span>
          {% endif %}
          <div class="rating-price" itemscope itemtype="https://schema.org/Review">
            <meta itemprop="name" content="{{excursion.title}}" />
            <span itemprop="reviewRating" itemscope itemtype="https://schema.org/Rating">
              <meta itemprop="ratingValue" content="{{excursion.reviews.count}}" />
              ⭐ {{ excursion.get_average_rating }}/5 ({{excursion.reviews.count}})
            </span>
            <span class="price" itemprop="offers" itemscope itemtype="https://schema.org/Offer">
              <span itemprop="priceCurrency" content="USD">$</span><span itemprop="price">{{excursion.price}}</span>
            </span>
          </div>
          <div class="action">
            <a href="{% url 'excursion_detail' excursion.slugy %}" class="book-link">
              <button class="book-btn">Book Now</button>
            </a>
          </div>
        </div>

        <!-- Schema Markup for Excursion -->
        <script type="application/ld+json">
              {
                  "@context": "https://schema.org",
                  "@type": "TouristTrip",
                  "name": "{{ excursion.title }}",
                  "description": "{{ excursion.description }}",
                  "image": "{{ excursion.main_image.url }}",
                  "offers": {
                      "@type": "Offer",
                      "priceCurrency": "USD",
                      "price": "{{ excursion.price }}",
                      "availability": "https://schema.org/InStock",
                      "url": "{% url 'excursion_detail' excursion.slugy %}"
                  },
                  "aggregateRating": {
                      "@type": "AggregateRating",
                      "ratingValue": "excursion.get_average_rating",
                      "reviewCount": "{{ excursion.reviews.count }}",
                      "priceCurrency": "USD"
                  },
                  "touristType": "International",
                  "provider": {
                      "@type": "Organization",
                      "name": "Punta Cana Discovery",
                      "url": "https://puntacanadiscovery.com"
                  }
              }
          </script>
      </div>
    </div>
    {% endfor %}
  </div>
</div>
{% endif%}



    <!-- Social media meta tags for SEO -->
    <meta name="description" content="{{ post.get_meta_description }}">
    <meta property="og:title" content="{{ post.get_meta_title }}">
    <meta property="og:description" content="{{ post.og_description }}">
    {% if post.og_image %}
      <meta property="og:image" content="{{ post.og_image.url }}">
    {% endif %}

<!-- Edit and Delete buttons for the author -->
  {% if user == post.author %}
  <a href="{% url 'blog:blogpost_update' post.slug %}">Edit Post</a>
  <a href="{% url 'blog:blogpost_delete' post.slug %}" onclick="return confirm('Are you sure you want to delete this post?');">Delete Post</a>
{% endif %}
  </article>
  <script src="{% static 'js/blogPostDetail.js' %}"></script>
{% endblock %}
